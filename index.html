<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="theme-color" content="#040506">
<title>Osama Meter</title>

<style>
/* === (نفس ألوانك – لم أعبث بها) === */
:root{
  --bg:#040506;
  --panel:#0b0f15;
  --border:rgba(255,255,255,.12);
  --white:#fff;
  --soft:rgba(255,255,255,.7);
  --green:#28ff8b;
  --amber:#ffcc66;
  --red:#ff3b3b;
}

/* RESET */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  background:radial-gradient(circle at 50% 10%, #0c1016, var(--bg) 70%);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  color:var(--white);
}

/* ===== DASHBOARD ===== */
.dashboard{
  height:100dvh;
  display:grid;
  grid-template-rows:auto 1fr auto;
}

/* ===== TOPBAR ===== */
.topbar{
  padding-top:env(safe-area-inset-top);
  background:linear-gradient(180deg,#3a0b0b,#260707);
  border-bottom:1px solid var(--border);
}
.topbar-inner{
  display:grid;
  grid-template-columns:auto 1fr;
  align-items:center;
  gap:12px;
  padding:6px 14px;
}
.brand{
  font-weight:900;
  letter-spacing:.14em;
  font-size:13px;
}

/* STATUS BAR */
.status{
  display:flex;
  justify-content:flex-end;
  gap:0;
  border:1px solid var(--border);
  border-radius:12px;
  overflow:hidden;
}
.status-item{
  display:flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  font-size:11px;
  border-left:1px solid var(--border);
}
.status-item:first-child{border-left:none}
.status-item svg{width:14px;height:14px;fill:currentColor}
.ok{color:var(--green)}

/* ===== HAZARD FLASH ===== */
.hazard-on .topbar{
  animation:hazardFlash .8s infinite;
}
@keyframes hazardFlash{
  0%,100%{background:linear-gradient(180deg,#3a0b0b,#260707)}
  50%{background:linear-gradient(180deg,#ff3b3b,#7a1010)}
}

/* ===== MAIN ===== */
.main{
  padding:16px;
  display:grid;
  grid-template-columns:1.2fr .8fr;
  gap:16px;
}
@media(max-width:800px){
  .main{grid-template-columns:1fr}
}

/* ===== SPEED CORE ===== */
.speed-core{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:22px;
  padding:24px;
}
.speed{
  text-align:center;
  font-size:72px;
  font-weight:950;
}
.unit{
  text-align:center;
  font-size:11px;
  letter-spacing:.28em;
  color:var(--soft);
}

/* ===== GAUGE ===== */
.gauge-wrap{display:grid;place-items:center;margin-top:16px}
.gauge{width:min(320px,100%)}
.track{
  stroke:rgba(255,255,255,.15);
  stroke-width:12;
  fill:none;
}
.progress{
  stroke:url(#grad);
  stroke-width:12;
  fill:none;
  stroke-linecap:round;
  stroke-dasharray:0 1;
}
.needle{
  transform-origin:160px 150px;
  transform-box:fill-box;
}
.needle line{stroke:#fff;stroke-width:4}
.needle circle{fill:#fff}

/* ===== INFO ===== */
.info{
  display:grid;
  gap:16px;
}
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
}
.label{
  font-size:11px;
  color:var(--soft);
}
.value{
  font-size:28px;
  font-weight:900;
  color:var(--amber);
}

/* DISTANCE RESET */
.distance-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.reset-btn{
  border:none;
  background:#1b1f26;
  color:#fff;
  padding:6px 10px;
  border-radius:10px;
  font-size:11px;
  cursor:pointer;
}

/* ===== FOOTER ===== */
.footer{
  padding:16px;
  padding-bottom:calc(16px + env(safe-area-inset-bottom));
  border-top:1px solid var(--border);
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
}
button{
  border:none;
  border-radius:18px;
  padding:14px;
  font-weight:900;
  background:#1b1f26;
  color:#fff;
}
button.active.hazard{background:var(--red);color:#000}
button.active.lock{background:var(--green);color:#000}
</style>
</head>

<body>

<div class="dashboard" id="dashboard">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">OSAMA&nbsp;METER</div>
      <div class="status">
        <div class="status-item">
          <!-- CLOCK ICON -->
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
          <span id="clock">--:--</span>
        </div>
        <div class="status-item">
          <!-- BATTERY -->
          <svg viewBox="0 0 24 24"><rect x="2" y="7" width="18" height="10" rx="2"/><rect x="20" y="10" width="2" height="4"/></svg>
          <span id="battery">--%</span>
        </div>
        <div class="status-item ok">
          <!-- GPS -->
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/></svg>
          <span id="gpsSpeed">0</span>
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN -->
  <div class="main">
    <div class="speed-core">
      <div class="speed" id="speed">0</div>
      <div class="unit">KM / H</div>

      <div class="gauge-wrap">
        <svg class="gauge" viewBox="0 0 320 180">
          <defs>
            <linearGradient id="grad">
              <stop offset="0%" stop-color="#28ff8b"/>
              <stop offset="70%" stop-color="#ffcc66"/>
              <stop offset="100%" stop-color="#ff3b3b"/>
            </linearGradient>
          </defs>

          <path class="track" pathLength="1"
            d="M40 150 A120 120 0 0 0 280 150"/>
          <path class="progress" id="arc" pathLength="1"
            d="M40 150 A120 120 0 0 0 280 150"/>

          <g class="needle" id="needle">
            <line x1="160" y1="150" x2="40" y2="150"/>
            <circle cx="160" cy="150" r="6"/>
          </g>
        </svg>
      </div>
    </div>

    <div class="info">
      <div class="card">
        <div class="label">GEAR</div>
        <div class="value" id="gear">N</div>
      </div>

      <div class="card">
        <div class="label">DISTANCE</div>
        <div class="distance-row">
          <div class="value" id="distance">0.0 km</div>
          <button class="reset-btn" id="resetDistance">RESET</button>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    <button id="lockBtn">KEEP SCREEN ON</button>
    <button id="hazardBtn">HAZARD</button>
  </div>

</div>

<script>
(() => {
  const $ = id => document.getElementById(id);

  const dashboard = $("dashboard");
  const speedEl = $("speed");
  const gearEl = $("gear");
  const gpsSpeedEl = $("gpsSpeed");
  const distanceEl = $("distance");
  const resetBtn = $("resetDistance");
  const arc = $("arc");
  const needle = $("needle");
  const hazardBtn = $("hazardBtn");
  const lockBtn = $("lockBtn");

  const MAX = 120;
  const LERP = 0.14;

  let realSpeed = 0;
  let displaySpeed = 0;
  let distance = 0;
  let lastPos = null;
  let hazardOn = false;
  let wakeLock = null;

  function gearFromSpeed(v){
    if(v === 0) return "N";
    if(v <= 10) return "G1";
    if(v <= 20) return "G2";
    if(v <= 30) return "G3";
    if(v <= 40) return "G4";
    return "G5";
  }

  function updateGauge(v){
    const r = Math.min(v / MAX, 1);
    needle.style.transform = `rotate(${r * 180}deg)`;
    arc.style.strokeDasharray = `${r} 1`;
  }

  navigator.geolocation.watchPosition(p=>{
    if(typeof p.coords.speed === "number"){
      realSpeed = Math.max(0, p.coords.speed * 3.6);
      gpsSpeedEl.textContent = Math.round(realSpeed);
    }

    if(lastPos){
      const dx = p.coords.latitude - lastPos.latitude;
      const dy = p.coords.longitude - lastPos.longitude;
      distance += Math.sqrt(dx*dx + dy*dy) * 111;
      distanceEl.textContent = distance.toFixed(2) + " km";
    }
    lastPos = p.coords;
  },()=>{}, {enableHighAccuracy:true});

  resetBtn.onclick = () => {
    distance = 0;
    lastPos = null;
    distanceEl.textContent = "0.0 km";
  };

  hazardBtn.onclick = () => {
    hazardOn = !hazardOn;
    dashboard.classList.toggle("hazard-on", hazardOn);
    hazardBtn.classList.toggle("active", hazardOn);
    hazardBtn.classList.toggle("hazard", hazardOn);
  };

  lockBtn.onclick = async () => {
    if(!wakeLock && "wakeLock" in navigator){
      wakeLock = await navigator.wakeLock.request("screen");
      lockBtn.classList.add("active","lock");
    }else{
      await wakeLock?.release();
      wakeLock = null;
      lockBtn.classList.remove("active","lock");
    }
  };

  function loop(){
    displaySpeed += (realSpeed - displaySpeed) * LERP;
    if(displaySpeed < 0.1) displaySpeed = 0;

    const s = Math.round(displaySpeed);
    speedEl.textContent = s;
    gearEl.textContent = gearFromSpeed(s);
    updateGauge(displaySpeed);

    requestAnimationFrame(loop);
  }
  loop();
})();
</script>

</body>
</html>
