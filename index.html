<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Osama Meter â€“ Classic GSAP Speedometer</title>

<!-- ================= REQUIRED LIBRARIES ================= -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.15.0/plugins/CSSPlugin.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.15.0/easing/EasePack.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.15.0/TweenLite.min.js"></script>

<style>
/* ================= BASE ================= */
*{ box-sizing:border-box; }

html,body{
  height:100%;
  margin:0;
}

body{
  background:#000;
  color:#fff;
  font-family:Arial, Helvetica, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* ================= LAYOUT ================= */
#wrapper{
  display:flex;
  gap:60px;
  align-items:center;
}

/* ================= GAUGE ================= */
#gauge{
  position:relative;
  width:320px;
  height:320px;
}

#circle{
  position:absolute;
  inset:0;
  border-radius:50%;
  border:10px solid #1a1a1a;
  background:#000;
}

/* Numbers */
#numbers{
  position:absolute;
  inset:0;
  font-size:12px;
  color:#fff;
}

#numbers span{
  position:absolute;
  left:50%;
  top:50%;
  transform-origin:50% 150px;
}

/* Unit label */
#mi-km{
  position:absolute;
  bottom:42px;
  width:100%;
  text-align:center;
  font-size:14px;
  color:#aaa;
  letter-spacing:1px;
}

/* Needle */
#needle{
  position:absolute;
  width:4px;
  height:140px;
  background:#ff2a4f;
  left:50%;
  bottom:50%;
  transform-origin:50% 100%;
  transform:rotate(-120deg);
}

/* Center hub */
#needle::after{
  content:"";
  position:absolute;
  bottom:-8px;
  left:-6px;
  width:16px;
  height:16px;
  border-radius:50%;
  background:#fff;
}

/* ================= INPUT PANEL ================= */
#left{
  min-width:200px;
}

#left div{
  margin-bottom:12px;
}

label{
  display:inline-block;
  width:90px;
}

input{
  width:90px;
  padding:5px;
  background:#000;
  border:1px solid #444;
  color:#fff;
}

#errmsg{
  margin-top:10px;
  color:#ff2a4f;
  font-size:12px;
}
</style>
</head>

<body>

<div id="wrapper">

  <!-- ================= SPEEDOMETER ================= -->
  <div id="gauge">
    <div id="circle"></div>
    <div id="numbers"></div>
    <div id="mi-km">MPH</div>
    <div id="needle"></div>
  </div>

  <!-- ================= INPUTS ================= -->
  <div id="left">
    <div>
      <label for="miles">Miles:</label>
      <input type="text" id="miles">
    </div>
    <div>
      <label for="kilometers">Kilometers:</label>
      <input type="text" id="kilometers">
    </div>
    <p id="errmsg"></p>
  </div>

</div>

<script>
/* ================= CONFIG ================= */
var MAX_MPH = 120;
var START_ANGLE = -120;
var END_ANGLE = 120;

/* ================= BUILD SCALE ================= */
for(var i = 0; i <= MAX_MPH; i += 10){
  var angle = START_ANGLE + (i / MAX_MPH) * (END_ANGLE - START_ANGLE);
  var mark = $("<span>"+i+"</span>");

  mark.css({
    transform:
      "rotate("+angle+"deg) translate(0,-145px) rotate("+(-angle)+"deg)"
  });

  $("#numbers").append(mark);
}

/* ================= NEEDLE CONTROL ================= */
function setSpeed(mph){
  var angle = START_ANGLE + (mph / MAX_MPH) * (END_ANGLE - START_ANGLE);

  TweenLite.to("#needle", 0.9, {
    rotation: angle,
    ease: Power2.easeOut
  });
}

/* ================= INPUT LOGIC ================= */
$("#miles").on("input", function(){
  var mph = parseFloat(this.value);

  if(isNaN(mph) || mph < 0 || mph > MAX_MPH){
    $("#errmsg").text("Miles must be between 0 and " + MAX_MPH);
    return;
  }

  $("#errmsg").text("");
  $("#kilometers").val((mph * 1.60934).toFixed(2));
  $("#mi-km").text("MPH");
  setSpeed(mph);
});

$("#kilometers").on("input", function(){
  var km = parseFloat(this.value);

  if(isNaN(km) || km < 0){
    $("#errmsg").text("Enter a valid kilometer value");
    return;
  }

  var mph = km / 1.60934;

  if(mph > MAX_MPH){
    $("#errmsg").text("Speed exceeds gauge limit");
    return;
  }

  $("#errmsg").text("");
  $("#miles").val(mph.toFixed(2));
  $("#mi-km").text("KM/H");
  setSpeed(mph);
});
</script>

</body>
</html>
